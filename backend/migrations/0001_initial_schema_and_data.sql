-- Initial schema and data migration
-- This creates all tables and inserts all initial/mock data

-- Create extension for UUID generation
CREATE EXTENSION IF NOT EXISTS "pgcrypto";

-- Create table for test executors
CREATE TABLE test_executors (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name TEXT NOT NULL,
    description TEXT,
    image TEXT NOT NULL,
    default_command TEXT NOT NULL,
    supported_file_types TEXT[] NOT NULL,
    environment_variables TEXT[] NOT NULL DEFAULT ARRAY[]::TEXT[],
    icon TEXT
);

-- Create table for test definitions
CREATE TABLE test_definitions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name TEXT NOT NULL,
    description TEXT,
    image TEXT NOT NULL,
    commands TEXT[] NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    executor_id UUID REFERENCES test_executors(id) ON DELETE SET NULL
);

-- Create table for test runs
CREATE TABLE test_runs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name TEXT NOT NULL,
    image TEXT NOT NULL,
    command TEXT[] NOT NULL,
    status TEXT NOT NULL CHECK (status IN ('Running', 'Completed', 'Failed', 'running', 'succeeded', 'failed')),
    created_at TIMESTAMPTZ DEFAULT now(),
    duration INTEGER,
    logs TEXT[],
    test_definition_id UUID REFERENCES test_definitions(id) ON DELETE SET NULL,
    executor_id UUID REFERENCES test_executors(id) ON DELETE SET NULL
);

-- Create table for test suites
CREATE TABLE test_suites (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name TEXT NOT NULL,
    description TEXT,
    execution_mode TEXT NOT NULL DEFAULT 'sequential',
    labels TEXT[] DEFAULT '{}',
    test_definition_ids UUID[] NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Create indexes for better performance
CREATE INDEX idx_test_definitions_executor_id ON test_definitions(executor_id);
CREATE INDEX idx_test_runs_executor_id ON test_runs(executor_id);
CREATE INDEX idx_test_runs_test_definition_id ON test_runs(test_definition_id);

-- Insert test executors with real UUIDs
INSERT INTO test_executors (id, name, description, image, default_command, supported_file_types, environment_variables, icon)
VALUES 
    ('b7e6c1e2-1a2b-4c3d-8e9f-000000000001', 'Jest Test Runner', 'Run JavaScript/TypeScript unit tests using Jest testing framework.', 'node:18-alpine', 'npm run test', ARRAY['js', 'ts', 'json'], ARRAY['NODE_ENV', 'CI'], '🧪'),
    ('b7e6c1e2-1a2b-4c3d-8e9f-000000000002', 'Cypress E2E Runner', 'Run end-to-end tests using Cypress testing framework.', 'cypress/included:12.17.4', 'npx cypress run', ARRAY['js', 'ts', 'json'], ARRAY['CYPRESS_baseUrl', 'CYPRESS_RECORD_KEY'], '🌊'),
    ('b7e6c1e2-1a2b-4c3d-8e9f-000000000003', 'Pytest Runner', 'Run Python unit and integration tests using pytest framework.', 'python:3.11-slim', 'pytest --verbose --junit-xml=test-results.xml', ARRAY['py', 'yaml', 'json'], ARRAY['PYTHONPATH', 'PYTEST_CURRENT_TEST'], '🐍'),
    ('b7e6c1e2-1a2b-4c3d-8e9f-000000000004', 'K6 Load Test Runner', 'Run performance and load tests using K6 framework.', 'grafana/k6:latest', 'k6 run --out json=results.json', ARRAY['js', 'json'], ARRAY['K6_WEB_DASHBOARD', 'K6_WEB_DASHBOARD_EXPORT'], '📈'),
    ('b7e6c1e2-1a2b-4c3d-8e9f-000000000005', 'Playwright Test Runner', 'Run cross-browser end-to-end tests using Playwright.', 'mcr.microsoft.com/playwright:v1.40.0-focal', 'npx playwright test', ARRAY['js', 'ts', 'json'], ARRAY['PLAYWRIGHT_BROWSERS_PATH', 'PLAYWRIGHT_HTML_REPORT'], '🎭'),
    ('b7e6c1e2-1a2b-4c3d-8e9f-000000000006', 'Postman Collection Runner', 'Run API tests using Postman collections with Newman.', 'postman/newman:alpine', 'newman run --reporters cli,json', ARRAY['json'], ARRAY['NEWMAN_REPORTER_JSON_EXPORT'], '📮'),
    ('b7e6c1e2-1a2b-4c3d-8e9f-000000000007', 'GitHub Actions Runner', 'Run tests in GitHub Actions compatible environment.', 'ghcr.io/actions/actions-runner:latest', './run.sh', ARRAY['yaml', 'yml', 'json'], ARRAY['GITHUB_ACTIONS', 'RUNNER_OS'], '🐙'),
    ('b7e6c1e2-1a2b-4c3d-8e9f-000000000008', 'Docker Container Runner', 'Run tests in isolated Docker containers with custom configurations.', 'docker:latest', 'docker run --rm', ARRAY['dockerfile', 'yaml', 'sh'], ARRAY['DOCKER_BUILDKIT'], '🐳');

-- Update all references in test_definitions and test_runs to use the above UUIDs for executor_id
-- For example, replace 'jest-executor' with 'b7e6c1e2-1a2b-4c3d-8e9f-000000000001', etc.

-- Use real UUIDs for test_definition IDs and update all references
-- react-component-tests: b7e6c1e2-1a2b-4c3d-8e9f-100000000001
-- api-integration-tests: b7e6c1e2-1a2b-4c3d-8e9f-100000000002
-- e2e-user-journey: b7e6c1e2-1a2b-4c3d-8e9f-100000000003
-- cypress-e2e-tests: b7e6c1e2-1a2b-4c3d-8e9f-100000000004
-- python-backend-tests: b7e6c1e2-1a2b-4c3d-8e9f-100000000005
-- k6-load-tests: b7e6c1e2-1a2b-4c3d-8e9f-100000000006
-- postman-api-tests: b7e6c1e2-1a2b-4c3d-8e9f-100000000007
-- security-scan-owasp: b7e6c1e2-1a2b-4c3d-8e9f-100000000008
-- github-actions-ci: b7e6c1e2-1a2b-4c3d-8e9f-100000000009
-- docker-integration-tests: b7e6c1e2-1a2b-4c3d-8e9f-10000000000a
-- mobile-app-tests: b7e6c1e2-1a2b-4c3d-8e9f-10000000000b

INSERT INTO test_definitions (id, name, description, image, commands, created_at, executor_id)
VALUES 
    ('b7e6c1e2-1a2b-4c3d-8e9f-100000000001', 'React Component Unit Tests', 'Test React components with Jest and React Testing Library including hooks, state management, and user interactions', 'node:18-alpine', ARRAY['npm ci', 'npm run test:unit -- --coverage --watchAll=false'], '2025-07-17 12:00:00+00', 'b7e6c1e2-1a2b-4c3d-8e9f-000000000001'),
    ('b7e6c1e2-1a2b-4c3d-8e9f-100000000002', 'REST API Integration Tests', 'Test REST API endpoints with authentication, CRUD operations, validation, and error handling', 'node:18-alpine', ARRAY['npm ci', 'npm run test:api -- --reporter=json --output=api-test-results.json'], '2025-07-16 12:00:00+00', 'b7e6c1e2-1a2b-4c3d-8e9f-000000000001'),
    ('b7e6c1e2-1a2b-4c3d-8e9f-100000000003', 'E2E User Journey Tests', 'Complete user journey testing: signup, login, product browsing, checkout, and order management', 'mcr.microsoft.com/playwright:v1.40.0-focal', ARRAY['npm ci', 'npx playwright install', 'npx playwright test --reporter=html'], '2025-07-15 12:00:00+00', 'b7e6c1e2-1a2b-4c3d-8e9f-000000000005'),
    ('b7e6c1e2-1a2b-4c3d-8e9f-100000000004', 'Cypress E2E Test Suite', 'Cross-browser end-to-end testing with Cypress including visual regression tests', 'cypress/included:12.17.4', ARRAY['npm ci', 'npx cypress run --browser chrome --record --key $CYPRESS_RECORD_KEY'], '2025-07-14 12:00:00+00', 'b7e6c1e2-1a2b-4c3d-8e9f-000000000002'),
    ('b7e6c1e2-1a2b-4c3d-8e9f-100000000005', 'Python Backend API Tests', 'Test Django/Flask backend APIs with pytest including database transactions and async operations', 'python:3.11-slim', ARRAY['pip install -r requirements.txt', 'pytest --cov=app --cov-report=html --junit-xml=test-results.xml'], '2025-07-13 12:00:00+00', 'b7e6c1e2-1a2b-4c3d-8e9f-000000000003'),
    ('b7e6c1e2-1a2b-4c3d-8e9f-100000000006', 'K6 Performance Load Tests', 'Load testing with K6 to simulate real user traffic and measure performance metrics', 'grafana/k6:latest', ARRAY['k6 run --vus 100 --duration 10m --out json=load-test-results.json load-test.js'], '2025-07-12 12:00:00+00', 'b7e6c1e2-1a2b-4c3d-8e9f-000000000004'),
    ('b7e6c1e2-1a2b-4c3d-8e9f-100000000007', 'Postman API Collection Tests', 'Run comprehensive API tests using Postman collections with Newman including authentication flows', 'postman/newman:alpine', ARRAY['newman run api-tests.postman_collection.json -e staging.postman_environment.json --reporters cli,json'], '2025-07-11 12:00:00+00', 'b7e6c1e2-1a2b-4c3d-8e9f-000000000006'),
    ('b7e6c1e2-1a2b-4c3d-8e9f-100000000008', 'OWASP Security Scan', 'Automated security testing using OWASP ZAP for vulnerability detection and penetration testing', 'owasp/zap2docker-stable', ARRAY['zap-baseline.py -t $TARGET_URL -r security-report.html -J security-report.json'], '2025-07-10 12:00:00+00', 'b7e6c1e2-1a2b-4c3d-8e9f-000000000008'),
    ('b7e6c1e2-1a2b-4c3d-8e9f-100000000009', 'GitHub Actions CI Pipeline', 'Complete CI/CD pipeline with GitHub Actions including linting, testing, building, and deployment', 'ghcr.io/actions/actions-runner:latest', ARRAY['./run-ci-pipeline.sh'], '2025-07-09 12:00:00+00', 'b7e6c1e2-1a2b-4c3d-8e9f-000000000007'),
    ('b7e6c1e2-1a2b-4c3d-8e9f-10000000000a', 'Docker Integration Tests', 'Test Docker containers and microservices integration with docker-compose and health checks', 'docker:latest', ARRAY['docker-compose -f docker-compose.test.yml up --build --abort-on-container-exit'], '2025-07-08 12:00:00+00', 'b7e6c1e2-1a2b-4c3d-8e9f-000000000008'),
    ('b7e6c1e2-1a2b-4c3d-8e9f-10000000000b', 'Mobile App Testing', 'Test React Native mobile app with Detox framework on iOS and Android simulators', 'detox/detox:latest', ARRAY['npm ci', 'detox test --configuration ios.sim.release'], '2025-07-07 12:00:00+00', 'b7e6c1e2-1a2b-4c3d-8e9f-000000000001');

-- Insert test runs
INSERT INTO test_runs (id, name, image, command, status, created_at, duration, logs, test_definition_id, executor_id)
VALUES 
    ('b7e6c1e2-1a2b-4c3d-8e9f-200000000001', 'React Component Unit Tests - PR #247', 'node:18-alpine', ARRAY['npm ci', 'npm run test:unit -- --coverage --watchAll=false'], 'succeeded', '2025-07-18 11:46:19+00', 145000, ARRAY['> Starting React component unit tests...', '> npm ci', 'added 1247 packages in 32s', '> npm run test:unit -- --coverage --watchAll=false', '', 'PASS src/components/Button/Button.test.tsx', '  Button Component', '    ✓ renders with default props (23ms)', '    ✓ renders with custom text (8ms)', '    ✓ handles click events (12ms)', '    ✓ applies custom className (5ms)', '', 'PASS src/components/Modal/Modal.test.tsx', '  Modal Component', '    ✓ renders when open (15ms)', '    ✓ does not render when closed (4ms)', '    ✓ calls onClose when backdrop clicked (18ms)', '', 'PASS src/hooks/useLocalStorage.test.ts', '  useLocalStorage Hook', '    ✓ returns initial value (12ms)', '    ✓ updates localStorage on setValue (16ms)', '    ✓ reads from localStorage on mount (8ms)', '', 'Test Suites: 24 passed, 24 total', 'Tests:       147 passed, 147 total', 'Snapshots:   0 total', 'Time:        142.45 s', 'Ran all test suites.', '', 'Coverage Summary:', '  Statements   : 94.2% (1847/1960)', '  Branches     : 89.7% (523/583)', '  Functions    : 92.1% (387/420)', '  Lines        : 94.8% (1798/1896)', '', '✅ All tests passed! Coverage above 80% threshold.'], 'b7e6c1e2-1a2b-4c3d-8e9f-100000000001', 'b7e6c1e2-1a2b-4c3d-8e9f-000000000001'),
    ('b7e6c1e2-1a2b-4c3d-8e9f-200000000002', 'REST API Integration Tests - Staging Deploy', 'node:18-alpine', ARRAY['npm ci', 'npm run test:api -- --reporter=json --output=api-test-results.json'], 'succeeded', '2025-07-18 11:16:19+00', 187000, ARRAY['> Starting REST API integration tests...', '> npm ci', 'added 892 packages in 28s', '> npm run test:api -- --reporter=json --output=api-test-results.json', '', 'PASS tests/api/auth.test.js', '  Authentication API', '    ✓ POST /api/auth/login - valid credentials (245ms)', '    ✓ POST /api/auth/login - invalid credentials (156ms)', '    ✓ POST /api/auth/refresh - valid token (89ms)', '    ✓ POST /api/auth/logout - authenticated user (76ms)', '', 'PASS tests/api/users.test.js', '  Users API', '    ✓ GET /api/users - list users (134ms)', '    ✓ GET /api/users/:id - get user by id (98ms)', '    ✓ POST /api/users - create new user (187ms)', '    ✓ PUT /api/users/:id - update user (156ms)', '    ✓ DELETE /api/users/:id - delete user (123ms)', '', 'PASS tests/api/products.test.js', '  Products API', '    ✓ GET /api/products - list products with pagination (167ms)', '    ✓ GET /api/products/:id - get product details (87ms)', '    ✓ POST /api/products - create product (admin only) (201ms)', '    ✓ PUT /api/products/:id - update product (145ms)', '', 'PASS tests/api/orders.test.js', '  Orders API', '    ✓ POST /api/orders - create order (234ms)', '    ✓ GET /api/orders - get user orders (112ms)', '    ✓ GET /api/orders/:id - get order details (98ms)', '    ✓ PUT /api/orders/:id/status - update order status (134ms)', '', 'Test Suites: 4 passed, 4 total', 'Tests:       17 passed, 17 total', 'Time:        156.78 s', '', '✅ All API integration tests passed!', '📊 Test results exported to api-test-results.json'], 'b7e6c1e2-1a2b-4c3d-8e9f-100000000002', 'b7e6c1e2-1a2b-4c3d-8e9f-000000000001'),
    ('b7e6c1e2-1a2b-4c3d-8e9f-200000000003', 'E2E User Journey Tests - Chrome', 'mcr.microsoft.com/playwright:v1.40.0-focal', ARRAY['npm ci', 'npx playwright install', 'npx playwright test --reporter=html'], 'running', '2025-07-18 12:01:19+00', NULL, ARRAY['> Starting Playwright E2E tests...', '> npm ci', 'added 1143 packages in 41s', '> npx playwright install', 'Downloading Chromium 119.0.6045.9 (playwright build v1091)...', 'Downloading Firefox 118.0.2 (playwright build v1427)...', 'Downloading Webkit 17.0 (playwright build v1883)...', '✅ Browsers downloaded successfully', '', '> npx playwright test --reporter=html', '', 'Running 12 tests using 4 workers', '', '  ✓ [chromium] › auth/login.spec.ts:3:1 › User can login with valid credentials (2.3s)', '  ✓ [chromium] › auth/login.spec.ts:8:1 › User sees error with invalid credentials (1.8s)', '  ✓ [chromium] › products/browse.spec.ts:3:1 › User can browse products (3.2s)', '  ✓ [chromium] › products/search.spec.ts:3:1 › User can search for products (2.7s)', '  ✓ [chromium] › cart/add-to-cart.spec.ts:3:1 › User can add products to cart (4.1s)', '  ⏳ [chromium] › cart/checkout.spec.ts:3:1 › User can complete checkout process', '  ⏳ [chromium] › profile/update.spec.ts:3:1 › User can update profile information', '  ⏳ [chromium] › orders/history.spec.ts:3:1 › User can view order history', '', 'Currently running: 4 tests in parallel...'], 'b7e6c1e2-1a2b-4c3d-8e9f-100000000003', 'b7e6c1e2-1a2b-4c3d-8e9f-000000000005'),
    ('b7e6c1e2-1a2b-4c3d-8e9f-200000000004', 'K6 Performance Load Tests - API Stress Test', 'grafana/k6:latest', ARRAY['k6 run --vus 100 --duration 10m --out json=load-test-results.json load-test.js'], 'failed', '2025-07-18 10:16:19+00', 285000, ARRAY['> Starting K6 load tests...', '> k6 run --vus 100 --duration 10m --out json=load-test-results.json load-test.js', '', '          /\      |‾‾| /‾‾/   /‾‾/', '     /\  /  \     |  |/  /   /  /', '    /  \/    \    |     (   /   ‾‾\', '   /          \   |  |\  \ |  (‾)  |', '  / __________ \  |__| \__\ \_____/ .io', '', '  execution: local', '     script: load-test.js', '     output: json (load-test-results.json)', '', '  scenarios: (100.00%) 1 scenario, 100 max VUs, 10m30s max duration', '           * default: 100 looping VUs for 10m0s (gracefulRampDown: 30s)', '', 'running (04m45s), 000/100 VUs, 14523 complete and 0 interrupted iterations', '', '✗ status was 200', ' ↳  92% — ✓ 13361 / ✗ 1162', '✗ response time < 500ms', ' ↳  78% — ✓ 11328 / ✗ 3195', '', '     data_received..................: 145 MB  507 kB/s', '     data_sent......................: 23 MB   79 kB/s', '     http_req_blocked...............: avg=5.23ms   min=0s       med=1.2ms    max=2.1s     p(90)=2.8ms    p(95)=4.7ms', '     http_req_connecting............: avg=2.1ms    min=0s       med=0s       max=487ms    p(90)=0s       p(95)=0s', '     http_req_duration..............: avg=1.89s    min=134ms    med=1.2s     max=8.7s     p(90)=3.4s     p(95)=4.8s', '     http_req_failed................: 8.00%   ✓ 1162      ✗ 13361', '     http_req_receiving.............: avg=45ms     min=0s       med=12ms     max=2.1s     p(90)=87ms     p(95)=156ms', '     http_req_sending...............: avg=2.1ms    min=0s       med=0s       max=234ms    p(90)=0s       p(95)=1ms', '     http_req_waiting...............: avg=1.84s    min=133ms    med=1.18s    max=8.6s     p(90)=3.3s     p(95)=4.7s', '     http_reqs......................: 14523   50.8/s', '     iteration_duration.............: avg=1.92s    min=135ms    med=1.22s    max=8.8s     p(90)=3.5s     p(95)=4.9s', '     iterations.....................: 14523   50.8/s', '     vus............................: 100     min=100     max=100', '     vus_max........................: 100     min=100     max=100', '', '❌ Performance test failed - 8% error rate exceeds 0.1% threshold', '❌ 78% of requests exceeded 500ms response time threshold', '⚠️  High response times detected - investigate server performance'], 'b7e6c1e2-1a2b-4c3d-8e9f-100000000006', 'b7e6c1e2-1a2b-4c3d-8e9f-000000000004'),
    ('b7e6c1e2-1a2b-4c3d-8e9f-200000000005', 'Python Backend API Tests - Django', 'python:3.11-slim', ARRAY['pip install -r requirements.txt', 'pytest --cov=app --cov-report=html --junit-xml=test-results.xml'], 'succeeded', '2025-07-18 09:16:19+00', 234000, ARRAY['> Starting Python backend tests...', '> pip install -r requirements.txt', 'Collecting Django==4.2.0', 'Collecting pytest==7.4.0', 'Collecting pytest-cov==4.1.0 pytest-django==4.5.2', 'Successfully installed Django-4.2.0 pytest-7.4.0 pytest-cov-4.1.0 pytest-django-4.5.2', '', '> pytest --cov=app --cov-report=html --junit-xml=test-results.xml', '', '========================== test session starts ===========================', 'platform linux -- Python 3.11.5, pytest-7.4.0, pluggy-1.2.0', 'rootdir: /app', 'plugins: cov-4.1.0, django-4.5.2', 'collected 89 items', '', 'tests/test_models.py::TestUserModel::test_user_creation PASSED         [ 1%]', 'tests/test_models.py::TestUserModel::test_user_str_representation PASSED [ 2%]', 'tests/test_models.py::TestProductModel::test_product_creation PASSED  [ 3%]', 'tests/test_models.py::TestProductModel::test_product_slug_generation PASSED [ 4%]', 'tests/test_views.py::TestUserViews::test_user_list_view PASSED        [ 5%]', 'tests/test_views.py::TestUserViews::test_user_detail_view PASSED      [ 6%]', 'tests/test_views.py::TestUserViews::test_user_create_view PASSED      [ 7%]', 'tests/test_views.py::TestProductViews::test_product_list_view PASSED  [ 8%]', 'tests/test_views.py::TestProductViews::test_product_detail_view PASSED [ 9%]', 'tests/test_api.py::TestAuthAPI::test_login_success PASSED            [10%]', 'tests/test_api.py::TestAuthAPI::test_login_failure PASSED            [11%]', 'tests/test_api.py::TestAuthAPI::test_token_refresh PASSED            [12%]', 'tests/test_api.py::TestProductAPI::test_product_list PASSED          [13%]', 'tests/test_api.py::TestProductAPI::test_product_create PASSED        [14%]', 'tests/test_api.py::TestProductAPI::test_product_update PASSED        [15%]', 'tests/test_api.py::TestProductAPI::test_product_delete PASSED        [16%]', '...', 'tests/test_utils.py::TestUtilityFunctions::test_generate_slug PASSED [100%]', '', '========================== 89 passed in 187.23s ==========================', '', 'Coverage Report:', 'Name                 Stmts   Miss  Cover   Missing', 'app/models.py          145     8    94%    23-24, 67, 89-92', 'app/views.py           234    12    95%    45-47, 123, 189-195', 'app/serializers.py      89     3    97%    34, 67-68', 'app/utils.py            67     2    97%    45, 78', 'app/tasks.py            45     5    89%    12-16', 'TOTAL                  580    30    95%', '', '✅ All tests passed! Coverage: 95% (above 85% threshold)', '📊 HTML coverage report generated: htmlcov/index.html'], 'b7e6c1e2-1a2b-4c3d-8e9f-100000000005', 'b7e6c1e2-1a2b-4c3d-8e9f-000000000003'),
    ('b7e6c1e2-1a2b-4c3d-8e9f-200000000006', 'Cypress E2E Test Suite - Chrome Browser', 'cypress/included:12.17.4', ARRAY['npm ci', 'npx cypress run --browser chrome --record'], 'succeeded', '2025-07-18 08:16:19+00', 425000, ARRAY['> Starting Cypress E2E tests...', '> npm ci', 'added 987 packages in 35s', '> npx cypress run --browser chrome --record', '', '====================================================================================================', '', '  (Run Starting)', '', '  ┌────────────────────────────────────────────────────────────────────────────────────────────────┐', '  │ Cypress:    12.17.4                                                                               │', '  │ Browser:    Chrome 119.0.6045.123                                                                │', '  │ Specs:      8 found (auth.cy.js, products.cy.js, cart.cy.js, checkout.cy.js, profile.cy.js, .. │', '  │ Searched:   cypress/e2e/**/*.cy.{js,jsx,ts,tsx}                                                  │', '  └────────────────────────────────────────────────────────────────────────────────────────────────┘', '', '', '────────────────────────────────────────────────────────────────────────────────────────────────────', '                                                                                                        ', '  Running:  auth.cy.js                                                                       (1 of 8)', '', '', '  Authentication Flow', '    ✓ should login with valid credentials (2456ms)', '    ✓ should show error for invalid credentials (1234ms)', '    ✓ should logout successfully (892ms)', '    ✓ should redirect to login when accessing protected route (1124ms)', '', '', '  4 passing (5.7s)', '', '  (Results)', '  ┌────────────────────────────────────────────────────────────────────────────────────────────────┐', '  │ Tests:        4                                                                                    │', '  │ Passing:      4                                                                                    │', '  │ Failing:      0                                                                                    │', '  │ Pending:      0                                                                                    │', '  │ Skipped:      0                                                                                    │', '  │ Screenshots:  0                                                                                    │', '  │ Video:        true                                                                                 │', '  │ Duration:     5 seconds                                                                            │', '  │ Spec Ran:     auth.cy.js                                                                           │', '  └────────────────────────────────────────────────────────────────────────────────────────────────┘', '', '  ...', '', '  (Run Finished)', '       Spec                                              Tests  Passing  Failing  Pending  Skipped  ', '  ┌────────────────────────────────────────────────────────────────────────────────────────────────┐', '  │ ✓  auth.cy.js                               00:05        4        4        0        0        0 │', '  │ ✓  products.cy.js                           00:08        6        6        0        0        0 │', '  │ ✓  cart.cy.js                               00:12        8        8        0        0        0 │', '  │ ✓  checkout.cy.js                           00:15       12       12        0        0        0 │', '  │ ✓  profile.cy.js                            00:07        5        5        0        0        0 │', '  │ ✓  orders.cy.js                             00:09        7        7        0        0        0 │', '  │ ✓  admin.cy.js                              00:11        9        9        0        0        0 │', '  │ ✓  search.cy.js                             00:06        4        4        0        0        0 │', '  └────────────────────────────────────────────────────────────────────────────────────────────────┘', '    ✓  All specs passed!                        07:03       55       55        0        0        0 ', '', '✅ All Cypress tests passed! 55/55 tests completed successfully', '🎥 Videos recorded for all test runs', '📊 Test results uploaded to Cypress Dashboard'], 'b7e6c1e2-1a2b-4c3d-8e9f-100000000004', 'b7e6c1e2-1a2b-4c3d-8e9f-000000000002'),
    ('b7e6c1e2-1a2b-4c3d-8e9f-200000000007', 'OWASP Security Vulnerability Scan', 'owasp/zap2docker-stable', ARRAY['zap-baseline.py -t https://staging.example.com -r security-report.html -J security-report.json'], 'failed', '2025-07-18 07:16:19+00', 892000, ARRAY['> Starting OWASP ZAP security scan...', '> zap-baseline.py -t https://staging.example.com -r security-report.html -J security-report.json', '', '2025-07-18 10:11:23,456 Starting ZAP 2.14.0', '2025-07-18 10:11:25,123 ZAP is now listening on 0.0.0.0:8080', '2025-07-18 10:11:26,789 Baseline scan started', '2025-07-18 10:11:27,234 Target: https://staging.example.com', '', 'Spider progress: 0% (0 URLs found)', 'Spider progress: 15% (47 URLs found)', 'Spider progress: 32% (89 URLs found)', 'Spider progress: 58% (124 URLs found)', 'Spider progress: 78% (156 URLs found)', 'Spider progress: 100% (178 URLs found)', '', 'Active scan progress: 0% (0 URLs scanned)', 'Active scan progress: 12% (21 URLs scanned)', 'Active scan progress: 34% (61 URLs scanned)', 'Active scan progress: 67% (119 URLs scanned)', 'Active scan progress: 89% (159 URLs scanned)', 'Active scan progress: 100% (178 URLs scanned)', '', 'PASS: Cookie No HttpOnly Flag [10010]', 'PASS: Cookie Without Secure Flag [10011]', 'PASS: Incomplete or No Cache-control Header Set [10015]', 'PASS: Cross-Domain JavaScript Source File Inclusion [10017]', 'PASS: Content-Type Header Missing [10019]', 'PASS: Information Disclosure - Debug Error Messages [10023]', 'PASS: Information Disclosure - Sensitive Information in URL [10024]', 'PASS: Information Disclosure - Sensitive Information in HTTP Referrer Header [10025]', 'PASS: HTTP Parameter Override [10026]', 'PASS: Information Disclosure - Suspicious Comments [10027]', 'PASS: Open Redirect [10028]', 'PASS: Cookie Poisoning [10029]', 'PASS: User Controllable Charset [10030]', 'PASS: User Controllable HTML Element Attribute (Potential XSS) [10031]', 'PASS: Viewstate [10032]', 'PASS: Directory Browsing [10033]', 'PASS: Heartbleed OpenSSL Vulnerability (Indicative) [10034]', 'PASS: Strict-Transport-Security Header [10035]', 'PASS: Server Leaks Information via "X-Powered-By" HTTP Response Header Field(s) [10037]', 'PASS: Content Security Policy (CSP) Header Not Set [10038]', 'PASS: X-Backend-Server Header Information Leak [10039]', '', 'WARN: X-Frame-Options Header [10020] x 3', '        https://staging.example.com/', '        https://staging.example.com/products', '        https://staging.example.com/cart', '', 'WARN: X-Content-Type-Options Header Missing [10021] x 5', '        https://staging.example.com/', '        https://staging.example.com/api/products', '        https://staging.example.com/api/users', '        https://staging.example.com/static/css/main.css', '        https://staging.example.com/static/js/main.js', '', 'FAIL: SQL Injection [90018] x 2', '        https://staging.example.com/api/products?category=', '        https://staging.example.com/api/search?q=', '', 'FAIL: Cross Site Scripting (Reflected) [40012] x 1', '        https://staging.example.com/search?term=', '', 'SUMMARY', '-------', 'Total alerts: 11', 'High: 2 (SQL Injection, XSS)', 'Medium: 3 (X-Frame-Options missing)', 'Low: 5 (X-Content-Type-Options missing)', 'Informational: 1', '', '❌ Security scan failed - 2 high-risk vulnerabilities found', '⚠️  SQL Injection vulnerabilities detected in API endpoints', '⚠️  XSS vulnerability found in search functionality', '📋 Detailed report saved to security-report.html'], 'b7e6c1e2-1a2b-4c3d-8e9f-100000000008', 'b7e6c1e2-1a2b-4c3d-8e9f-000000000008');

-- Insert test suites
INSERT INTO test_suites (id, name, description, execution_mode, labels, test_definition_ids, created_at)
VALUES 
    ('frontend-test-suite', 'Frontend Test Suite', 'Comprehensive frontend testing including React components, E2E user journeys, and visual regression tests', 'sequential', ARRAY['frontend', 'react', 'e2e', 'ui'], ARRAY['b7e6c1e2-1a2b-4c3d-8e9f-100000000001', 'b7e6c1e2-1a2b-4c3d-8e9f-100000000003', 'b7e6c1e2-1a2b-4c3d-8e9f-100000000004']::UUID[], '2025-07-17 12:00:00+00'),
    ('backend-api-suite', 'Backend API Test Suite', 'Complete backend API testing including REST endpoints, authentication, and database operations', 'parallel', ARRAY['backend', 'api', 'integration', 'authentication'], ARRAY['b7e6c1e2-1a2b-4c3d-8e9f-100000000002', 'b7e6c1e2-1a2b-4c3d-8e9f-100000000005', 'b7e6c1e2-1a2b-4c3d-8e9f-100000000007']::UUID[], '2025-07-16 12:00:00+00'),
    ('performance-suite', 'Performance Test Suite', 'Load testing and performance benchmarks to ensure application scalability', 'sequential', ARRAY['performance', 'load', 'scalability', 'k6'], ARRAY['b7e6c1e2-1a2b-4c3d-8e9f-100000000006']::UUID[], '2025-07-15 12:00:00+00'),
    ('security-suite', 'Security Test Suite', 'Comprehensive security testing including vulnerability scanning and penetration testing', 'sequential', ARRAY['security', 'vulnerability', 'owasp', 'penetration'], ARRAY['b7e6c1e2-1a2b-4c3d-8e9f-100000000008']::UUID[], '2025-07-14 12:00:00+00'),
    ('ci-cd-suite', 'CI/CD Pipeline Test Suite', 'Complete CI/CD pipeline testing including build, test, and deployment validation', 'sequential', ARRAY['ci', 'cd', 'pipeline', 'deployment', 'docker'], ARRAY['b7e6c1e2-1a2b-4c3d-8e9f-100000000009', 'b7e6c1e2-1a2b-4c3d-8e9f-10000000000a']::UUID[], '2025-07-13 12:00:00+00'),
    ('mobile-suite', 'Mobile Application Test Suite', 'Mobile app testing for React Native applications on iOS and Android platforms', 'sequential', ARRAY['mobile', 'react-native', 'ios', 'android'], ARRAY['b7e6c1e2-1a2b-4c3d-8e9f-10000000000b']::UUID[], '2025-07-12 12:00:00+00'),
    ('regression-suite', 'Regression Test Suite', 'Automated regression testing to ensure new changes don''t break existing functionality', 'parallel', ARRAY['regression', 'automated', 'stability'], ARRAY['b7e6c1e2-1a2b-4c3d-8e9f-100000000001', 'b7e6c1e2-1a2b-4c3d-8e9f-100000000002', 'b7e6c1e2-1a2b-4c3d-8e9f-100000000003']::UUID[], '2025-07-11 12:00:00+00');
